Chrome web socket extension for DPA is not working in Chrome version 136

The Chrome WebSocket extension for DPA not working in Chrome version 136 is likely related to changes in Chrome's extension platform, specifically the transition from Manifest V2 to Manifest V3. Chrome 136 has started disabling Manifest V2 extensions by default, which breaks many existing extensions that rely on it. A temporary workaround reported is:

- Go to `chrome://flags/`
- Search for "manifest v2" and set it to "Disabled"
- Restart Chrome
- Re-enable the extension on the extensions page (`chrome://extensions/`)
- Restart Chrome again

This can temporarily restore functionality, but support for Manifest V2 extensions will be fully removed by Chrome version 139 (expected around July), so a long-term fix requires updating the extension to Manifest V3 or switching to a browser like Firefox that still supports Manifest V2[6].

Additionally, Chrome 116 and later improved WebSocket support in extension service workers, requiring keepalive messages to maintain connections. If your extension uses WebSockets in a service worker, ensure it implements a keepalive mechanism to prevent the service worker from being terminated and the WebSocket connection from closing[4].

In summary, the main issue is the Manifest V2 deprecation in Chrome 136 affecting extension compatibility, and WebSocket connection management changes in newer Chrome versions. Updating the extension to Manifest V3 and implementing WebSocket keepalive are recommended steps.

Citations:
[1] Is anyone experiencing WebSocket Realtime Error on Chrome ... https://community.openai.com/t/is-anyone-experiencing-websocket-realtime-error-on-chrome-browser/1091793?page=2
[2] Cannot get websocket connection to work in Chrome 19 https://stackoverflow.com/questions/10456706/cannot-get-websocket-connection-to-work-in-chrome-19
[3] Chrome not connecting to websocket server · Issue #144 - GitHub https://github.com/beyondcode/laravel-websockets/issues/144
[4] Use WebSockets in service workers | Chrome Extensions https://developer.chrome.com/docs/extensions/how-to/web-platform/websockets
[5] Chrome 59+ websocket frames no longer visible in DevTools https://stackoverflow.com/questions/44533111/chrome-59-websocket-frames-no-longer-visible-in-devtools/72905810
[6] Any changelog for Chrome 136? - Reddit https://www.reddit.com/r/chrome/comments/1jmr7dg/any_changelog_for_chrome_136/
[7] Chrome extension - WebSocket No Connection Made https://groups.google.com/a/chromium.org/g/chromium-extensions/c/9FgD9EGYjps
[8] Chrome Web Inspector Web Socket Debugging - Stack Overflow https://stackoverflow.com/questions/8952773/chrome-web-inspector-web-socket-debugging
What troubleshooting steps can I take to adapt my extension for compatibility with Chrome 136

The Chrome WebSocket extension for DPA fails in version 136 due to two primary changes in Chrome’s architecture and policies, while functioning in earlier versions that still support older frameworks[4][7]. Here’s a structured breakdown of the compatibility issues:

## 1. **Manifest V2 Deprecation**
Chrome 136 disables Manifest V2 extensions by default as part of Google’s phased transition to Manifest V3[4][7]. Key impacts include:
- **Loss of background pages**: Manifest V3 replaces persistent background pages with ephemeral service workers, disrupting WebSocket connections that rely on continuous background processes[7].
- **Restricted APIs**: Older extensions using deprecated APIs (e.g., `chrome.extension.connect`) are no longer functional[5].

**Workaround**: Temporarily re-enable Manifest V2 support by:
  1. Navigating to `chrome://flags/#manifest-v2`.
  2. Setting the flag to **Disabled** (paradoxically re-enabling V2 support)[4].
  3. Restarting Chrome and reactivating the extension[4].

This fix is temporary and will cease working when Chrome 139 removes Manifest V2 entirely in July[4].

---

## 2. **WebSocket Handling in Service Workers**
Starting in Chrome 116, WebSocket connections in service workers require **keepalive mechanisms** to prevent premature termination[4][7]. Issues arise if:
- The extension lacks periodic messages to keep the service worker active.
- WebSocket ping/pong frames or `setInterval()`-based heartbeats are missing.

**Solution**: Implement a keepalive strategy, such as:
```javascript
// Example WebSocket keepalive in a service worker
const ws = new WebSocket('wss://example.com');
setInterval(() => {
  if (ws.readyState === WebSocket.OPEN) {
    ws.send('{"type": "keepalive"}');
  }
}, 30000);
```

---

## 3. **Policy Enforcement in Manifest V3**
Manifest V3 introduces stricter content security policies[5][7]:
- **Remote code execution**: Extensions can no longer load external scripts via `<script src="http://remote.com/code.js">`[5].
- **Eval restrictions**: Using `eval()` or `new Function()` triggers violations[5].

**Adaptation steps**:
- Bundle all code locally within the extension package.
- Replace dynamic code execution with declarative Net Request API for network handling[7].
- Audit the codebase for `eval()`-like patterns and refactor them.

---

## 4. **Testing and Validation**
- **Verify Chrome version**: Ensure the extension is tested on Chrome ≥116 with DevTools’ **Manifest V3 migration warnings**[2][7].
- **Use Chrome’s review tools**: The **Issues tab** now flags low-contrast UI elements and Trusted Types violations, which could indirectly affect WebSocket data handling[2].

For long-term stability, prioritize migrating to Manifest V3 and adopting Chrome’s updated WebSocket practices[4][5][7].

Citations:
[1] Fix problems with apps, extensions, or themes - Chrome Web Store ... https://support.google.com/chrome_webstore/answer/1698338
[2] What's new in DevTools, Chrome 136 | Blog https://developer.chrome.com/blog/new-in-devtools-136
[3] How to enable Chrome Compatibility Mode - BrowserStack https://www.browserstack.com/guide/chrome-compatibility-mode
[4] Any changelog for Chrome 136? - Reddit https://www.reddit.com/r/chrome/comments/1jmr7dg/any_changelog_for_chrome_136/
[5] Troubleshooting Chrome Web Store violations | Chrome Extensions | Chrome for Developers https://developer.chrome.com/docs/webstore/troubleshooting
[6] Troubleshooting the Chrome Extension & Builder https://docs.appcues.com/dev-troubleshooting/faq-troubleshooting-the-chrome-extension-builder
[7] Previous release notes - Chrome Enterprise and Education Help https://support.google.com/chrome/a/answer/10314655
[8] What's new in Chrome extensions - Chrome for Developers https://developer.chrome.com/docs/extensions/whats-new
